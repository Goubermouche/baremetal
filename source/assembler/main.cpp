#include "assembler/assembler.h"

#include <utility/streams/console.h>
#include <utility/dynamic_string.h>

using namespace utility::types;

auto bytes_to_string(const utility::dynamic_array<utility::byte>& bytes) -> utility::dynamic_string {
	utility::dynamic_string result;
	result.reserve(bytes.get_size() * 2);

	constexpr char digits[] = "0123456789abcdef";

	for(u64 i = 0; i < bytes.get_size(); ++i) {
		const utility::byte value = bytes[i];
		result.push_back(digits[(value >> 4) & utility::byte(0x0F)]);
		result.push_back(digits[value & utility::byte(0x0F)]);
	}

	return result;
}

u64 g_fail_counter = 0;
u64 g_success_counter = 0;

#define TEST_INST(expected, instruction)                                                                             \
do {                                                                                                                 \
  assembler.instruction;                                                                                             \
  utility::dynamic_string result = bytes_to_string(assembler.get_bytes());                                           \
	if((expected) != result) {                                                                                         \
		utility::console::print("error: \"{}\", expected \"{}\", but got \"{}\"\n", #instruction, (expected), result); \
    g_fail_counter++;                                                                                                \
	}                                                                                                                  \
	else {                                                                                                             \
    g_success_counter++;                                                                                             \
	}                          \
	assembler.clear();                                                                                       \
} while(false)

void run_tests() {
	using namespace baremetal;

	assembler assembler; 

	utility::timer timer;

	TEST_INST("b900000000"              , mov(rcx, 0)                              );
	TEST_INST("b9ffffff7f"              , mov(rcx, 2147483647)                     );
	TEST_INST("48c7c100000080"          , mov(rcx, -2147483648)                    );
	TEST_INST("b9ff7f0000"              , mov(rcx, 32767)                          );
	TEST_INST("48c7c10080ffff"          , mov(rcx, -32768)                         );
	TEST_INST("b97f000000"              , mov(rcx, 127)                            );
	TEST_INST("48c7c180ffffff"          , mov(rcx, -128)                           );
	TEST_INST("ba00000000"              , mov(rdx, 0)                              );
	TEST_INST("baffffff7f"              , mov(rdx, 2147483647)                     );
	TEST_INST("48c7c200000080"          , mov(rdx, -2147483648)                    );
	TEST_INST("baff7f0000"              , mov(rdx, 32767)                          );
	TEST_INST("48c7c20080ffff"          , mov(rdx, -32768)                         );
	TEST_INST("ba7f000000"              , mov(rdx, 127)                            );
	TEST_INST("48c7c280ffffff"          , mov(rdx, -128)                           );
	TEST_INST("bb00000000"              , mov(rbx, 0)                              );
	TEST_INST("bbffffff7f"              , mov(rbx, 2147483647)                     );
	TEST_INST("48c7c300000080"          , mov(rbx, -2147483648)                    );
	TEST_INST("bbff7f0000"              , mov(rbx, 32767)                          );
	TEST_INST("48c7c30080ffff"          , mov(rbx, -32768)                         );
	TEST_INST("bb7f000000"              , mov(rbx, 127)                            );
	TEST_INST("48c7c380ffffff"          , mov(rbx, -128)                           );
	TEST_INST("41bf00000000"            , mov(r15, 0)                              );
	TEST_INST("41bfffffff7f"            , mov(r15, 2147483647)                     );
	TEST_INST("49c7c700000080"          , mov(r15, -2147483648)                    );
	TEST_INST("41bfff7f0000"            , mov(r15, 32767)                          );
	TEST_INST("49c7c70080ffff"          , mov(r15, -32768)                         );
	TEST_INST("41bf7f000000"            , mov(r15, 127)                            );
	TEST_INST("49c7c780ffffff"          , mov(r15, -128)                           );
	TEST_INST("48c705f5ffffff00000000"  , mov(mem64::ptr(rip, 0x0), 0)             );
	TEST_INST("48c705f5ffffffffffff7f"  , mov(mem64::ptr(rip, 0x0), 2147483647)    );
	TEST_INST("48c705f5ffffff00000080"  , mov(mem64::ptr(rip, 0x0), -2147483648)   );
	TEST_INST("48c705f5ffffffff7f0000"  , mov(mem64::ptr(rip, 0x0), 32767)         );
	TEST_INST("48c705f5ffffff0080ffff"  , mov(mem64::ptr(rip, 0x0), -32768)        );
	TEST_INST("48c705f5ffffff7f000000"  , mov(mem64::ptr(rip, 0x0), 127)           );
	TEST_INST("48c705f5ffffff80ffffff"  , mov(mem64::ptr(rip, 0x0), -128)          );
	TEST_INST("48c705f400000000000000"  , mov(mem64::ptr(rip, 0xFF), 0)            );
	TEST_INST("48c705f4000000ffffff7f"  , mov(mem64::ptr(rip, 0xFF), 2147483647)   );
	TEST_INST("48c705f400000000000080"  , mov(mem64::ptr(rip, 0xFF), -2147483648)  );
	TEST_INST("48c705f4000000ff7f0000"  , mov(mem64::ptr(rip, 0xFF), 32767)        );
	TEST_INST("48c705f40000000080ffff"  , mov(mem64::ptr(rip, 0xFF), -32768)       );
	TEST_INST("48c705f40000007f000000"  , mov(mem64::ptr(rip, 0xFF), 127)          );
	TEST_INST("48c705f400000080ffffff"  , mov(mem64::ptr(rip, 0xFF), -128)         );
	TEST_INST("48c705f4ff000000000000"  , mov(mem64::ptr(rip, 0xFFFF), 0)          );
	TEST_INST("48c705f4ff0000ffffff7f"  , mov(mem64::ptr(rip, 0xFFFF), 2147483647) );
	TEST_INST("48c705f4ff000000000080"  , mov(mem64::ptr(rip, 0xFFFF), -2147483648));
	TEST_INST("48c705f4ff0000ff7f0000"  , mov(mem64::ptr(rip, 0xFFFF), 32767)      );
	TEST_INST("48c705f4ff00000080ffff"  , mov(mem64::ptr(rip, 0xFFFF), -32768)     );
	TEST_INST("48c705f4ff00007f000000"  , mov(mem64::ptr(rip, 0xFFFF), 127)        );
	TEST_INST("48c705f4ff000080ffffff"  , mov(mem64::ptr(rip, 0xFFFF), -128)       );
	TEST_INST("48c70000000000"          , mov(mem64::ptr(rax), 0)                  );
	TEST_INST("48c700ffffff7f"          , mov(mem64::ptr(rax), 2147483647)         );
	TEST_INST("48c70000000080"          , mov(mem64::ptr(rax), -2147483648)        );
	TEST_INST("48c700ff7f0000"          , mov(mem64::ptr(rax), 32767)              );
	TEST_INST("48c7000080ffff"          , mov(mem64::ptr(rax), -32768)             );
	TEST_INST("48c7007f000000"          , mov(mem64::ptr(rax), 127)                );
	TEST_INST("48c70080ffffff"          , mov(mem64::ptr(rax), -128)               );
	TEST_INST("48c70000000000"          , mov(mem64::ptr(rax, 0x0), 0)             );
	TEST_INST("48c700ffffff7f"          , mov(mem64::ptr(rax, 0x0), 2147483647)    );
	TEST_INST("48c70000000080"          , mov(mem64::ptr(rax, 0x0), -2147483648)   );
	TEST_INST("48c700ff7f0000"          , mov(mem64::ptr(rax, 0x0), 32767)         );
	TEST_INST("48c7000080ffff"          , mov(mem64::ptr(rax, 0x0), -32768)        );
	TEST_INST("48c7007f000000"          , mov(mem64::ptr(rax, 0x0), 127)           );
	TEST_INST("48c70080ffffff"          , mov(mem64::ptr(rax, 0x0), -128)          );
	TEST_INST("48c780ffff000000000000"  , mov(mem64::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("48c780ffff0000ffffff7f"  , mov(mem64::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("48c780ffff000000000080"  , mov(mem64::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("48c780ffff0000ff7f0000"  , mov(mem64::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("48c780ffff00000080ffff"  , mov(mem64::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("48c780ffff00007f000000"  , mov(mem64::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("48c780ffff000080ffffff"  , mov(mem64::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("48c70000000000"          , mov(mem64::ptr(rax, 0x0), 0)             );
	TEST_INST("48c700ffffff7f"          , mov(mem64::ptr(rax, 0x0), 2147483647)    );
	TEST_INST("48c70000000080"          , mov(mem64::ptr(rax, 0x0), -2147483648)   );
	TEST_INST("48c700ff7f0000"          , mov(mem64::ptr(rax, 0x0), 32767)         );
	TEST_INST("48c7000080ffff"          , mov(mem64::ptr(rax, 0x0), -32768)        );
	TEST_INST("48c7007f000000"          , mov(mem64::ptr(rax, 0x0), 127)           );
	TEST_INST("48c70080ffffff"          , mov(mem64::ptr(rax, 0x0), -128)          );
	TEST_INST("48c780ffff000000000000"  , mov(mem64::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("48c780ffff0000ffffff7f"  , mov(mem64::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("48c780ffff000000000080"  , mov(mem64::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("48c780ffff0000ff7f0000"  , mov(mem64::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("48c780ffff00000080ffff"  , mov(mem64::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("48c780ffff00007f000000"  , mov(mem64::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("48c780ffff000080ffffff"  , mov(mem64::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("48c780ffff000000000000"  , mov(mem64::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("48c780ffff0000ffffff7f"  , mov(mem64::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("48c780ffff000000000080"  , mov(mem64::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("48c780ffff0000ff7f0000"  , mov(mem64::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("48c780ffff00000080ffff"  , mov(mem64::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("48c780ffff00007f000000"  , mov(mem64::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("48c780ffff000080ffffff"  , mov(mem64::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("48c780ffff000000000000"  , mov(mem64::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("48c780ffff0000ffffff7f"  , mov(mem64::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("48c780ffff000000000080"  , mov(mem64::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("48c780ffff0000ff7f0000"  , mov(mem64::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("48c780ffff00000080ffff"  , mov(mem64::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("48c780ffff00007f000000"  , mov(mem64::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("48c780ffff000080ffffff"  , mov(mem64::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("48c780ffff000000000000"  , mov(mem64::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("48c780ffff0000ffffff7f"  , mov(mem64::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("48c780ffff000000000080"  , mov(mem64::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("48c780ffff0000ff7f0000"  , mov(mem64::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("48c780ffff00000080ffff"  , mov(mem64::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("48c780ffff00007f000000"  , mov(mem64::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("48c780ffff000080ffffff"  , mov(mem64::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("48c78424ffff000000000000", mov(mem64::ptr(rsp, 0xFFFF), 0)          );
	TEST_INST("48c78424ffff0000ffffff7f", mov(mem64::ptr(rsp, 0xFFFF), 2147483647) );
	TEST_INST("48c78424ffff000000000080", mov(mem64::ptr(rsp, 0xFFFF), -2147483648));
	TEST_INST("48c78424ffff0000ff7f0000", mov(mem64::ptr(rsp, 0xFFFF), 32767)      );
	TEST_INST("48c78424ffff00000080ffff", mov(mem64::ptr(rsp, 0xFFFF), -32768)     );
	TEST_INST("48c78424ffff00007f000000", mov(mem64::ptr(rsp, 0xFFFF), 127)        );
	TEST_INST("48c78424ffff000080ffffff", mov(mem64::ptr(rsp, 0xFFFF), -128)       );
	TEST_INST("8b1dfaffffff"            , mov(ebx, mem32::ptr(rip, 0x0))           );
	TEST_INST("8b1df9000000"            , mov(ebx, mem32::ptr(rip, 0xFF))          );
	TEST_INST("8b1df9ff0000"            , mov(ebx, mem32::ptr(rip, 0xFFFF))        );
	TEST_INST("8b18"                    , mov(ebx, mem32::ptr(rax))                );
	TEST_INST("8b18"                    , mov(ebx, mem32::ptr(rax, 0x0))           );
	TEST_INST("8b98ffff0000"            , mov(ebx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b18"                    , mov(ebx, mem32::ptr(rax, 0x0))           );
	TEST_INST("8b98ffff0000"            , mov(ebx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b98ffff0000"            , mov(ebx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b98ffff0000"            , mov(ebx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b98ffff0000"            , mov(ebx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b9c24ffff0000"          , mov(ebx, mem32::ptr(rsp, 0xFFFF))        );
	TEST_INST("448b3df9ffffff"          , mov(r15d, mem32::ptr(rip, 0x0))          );
	TEST_INST("448b3df8000000"          , mov(r15d, mem32::ptr(rip, 0xFF))         );
	TEST_INST("448b3df8ff0000"          , mov(r15d, mem32::ptr(rip, 0xFFFF))       );
	TEST_INST("448b38"                  , mov(r15d, mem32::ptr(rax))               );
	TEST_INST("448b38"                  , mov(r15d, mem32::ptr(rax, 0x0))          );
	TEST_INST("448bb8ffff0000"          , mov(r15d, mem32::ptr(rax, 0xFFFF))       );
	TEST_INST("448b38"                  , mov(r15d, mem32::ptr(rax, 0x0))          );
	TEST_INST("448bb8ffff0000"          , mov(r15d, mem32::ptr(rax, 0xFFFF))       );
	TEST_INST("448bb8ffff0000"          , mov(r15d, mem32::ptr(rax, 0xFFFF))       );
	TEST_INST("448bb8ffff0000"          , mov(r15d, mem32::ptr(rax, 0xFFFF))       );
	TEST_INST("448bb8ffff0000"          , mov(r15d, mem32::ptr(rax, 0xFFFF))       );
	TEST_INST("448bbc24ffff0000"        , mov(r15d, mem32::ptr(rsp, 0xFFFF))       );
	TEST_INST("488b0df9ffffff"          , mov(rcx, mem64::ptr(rip, 0x0))           );
	TEST_INST("488b0df8000000"          , mov(rcx, mem64::ptr(rip, 0xFF))          );
	TEST_INST("488b0df8ff0000"          , mov(rcx, mem64::ptr(rip, 0xFFFF))        );
	TEST_INST("488b08"                  , mov(rcx, mem64::ptr(rax))                );
	TEST_INST("488b08"                  , mov(rcx, mem64::ptr(rax, 0x0))           );
	TEST_INST("488b88ffff0000"          , mov(rcx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b08"                  , mov(rcx, mem64::ptr(rax, 0x0))           );
	TEST_INST("488b88ffff0000"          , mov(rcx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b88ffff0000"          , mov(rcx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b88ffff0000"          , mov(rcx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b88ffff0000"          , mov(rcx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b8c24ffff0000"        , mov(rcx, mem64::ptr(rsp, 0xFFFF))        );
	TEST_INST("488b15f9ffffff"          , mov(rdx, mem64::ptr(rip, 0x0))           );
	TEST_INST("488b15f8000000"          , mov(rdx, mem64::ptr(rip, 0xFF))          );
	TEST_INST("488b15f8ff0000"          , mov(rdx, mem64::ptr(rip, 0xFFFF))        );
	TEST_INST("488b10"                  , mov(rdx, mem64::ptr(rax))                );
	TEST_INST("488b10"                  , mov(rdx, mem64::ptr(rax, 0x0))           );
	TEST_INST("488b90ffff0000"          , mov(rdx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b10"                  , mov(rdx, mem64::ptr(rax, 0x0))           );
	TEST_INST("488b90ffff0000"          , mov(rdx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b90ffff0000"          , mov(rdx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b90ffff0000"          , mov(rdx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b90ffff0000"          , mov(rdx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b9424ffff0000"        , mov(rdx, mem64::ptr(rsp, 0xFFFF))        );
	TEST_INST("488b1df9ffffff"          , mov(rbx, mem64::ptr(rip, 0x0))           );
	TEST_INST("488b1df8000000"          , mov(rbx, mem64::ptr(rip, 0xFF))          );
	TEST_INST("488b1df8ff0000"          , mov(rbx, mem64::ptr(rip, 0xFFFF))        );
	TEST_INST("488b18"                  , mov(rbx, mem64::ptr(rax))                );
	TEST_INST("488b18"                  , mov(rbx, mem64::ptr(rax, 0x0))           );
	TEST_INST("488b98ffff0000"          , mov(rbx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b18"                  , mov(rbx, mem64::ptr(rax, 0x0))           );
	TEST_INST("488b98ffff0000"          , mov(rbx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b98ffff0000"          , mov(rbx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b98ffff0000"          , mov(rbx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b98ffff0000"          , mov(rbx, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("488b9c24ffff0000"        , mov(rbx, mem64::ptr(rsp, 0xFFFF))        );
	TEST_INST("4c8b3df9ffffff"          , mov(r15, mem64::ptr(rip, 0x0))           );
	TEST_INST("4c8b3df8000000"          , mov(r15, mem64::ptr(rip, 0xFF))          );
	TEST_INST("4c8b3df8ff0000"          , mov(r15, mem64::ptr(rip, 0xFFFF))        );
	TEST_INST("4c8b38"                  , mov(r15, mem64::ptr(rax))                );
	TEST_INST("4c8b38"                  , mov(r15, mem64::ptr(rax, 0x0))           );
	TEST_INST("4c8bb8ffff0000"          , mov(r15, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("4c8b38"                  , mov(r15, mem64::ptr(rax, 0x0))           );
	TEST_INST("4c8bb8ffff0000"          , mov(r15, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("4c8bb8ffff0000"          , mov(r15, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("4c8bb8ffff0000"          , mov(r15, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("4c8bb8ffff0000"          , mov(r15, mem64::ptr(rax, 0xFFFF))        );
	TEST_INST("4c8bbc24ffff0000"        , mov(r15, mem64::ptr(rsp, 0xFFFF))        );
	TEST_INST("b100"                    , mov(cl, 0)                               );
	TEST_INST("b17f"                    , mov(cl, 127)                             );
	TEST_INST("b180"                    , mov(cl, -128)                            );
	TEST_INST("b200"                    , mov(dl, 0)                               );
	TEST_INST("b27f"                    , mov(dl, 127)                             );
	TEST_INST("b280"                    , mov(dl, -128)                            );
	TEST_INST("b300"                    , mov(bl, 0)                               );
	TEST_INST("b37f"                    , mov(bl, 127)                             );
	TEST_INST("b380"                    , mov(bl, -128)                            );
	TEST_INST("66b90000"                , mov(cx, 0)                               );
	TEST_INST("66b9ff7f"                , mov(cx, 32767)                           );
	TEST_INST("66b90080"                , mov(cx, -32768)                          );
	TEST_INST("66b97f00"                , mov(cx, 127)                             );
	TEST_INST("66b980ff"                , mov(cx, -128)                            );
	TEST_INST("66ba0000"                , mov(dx, 0)                               );
	TEST_INST("66baff7f"                , mov(dx, 32767)                           );
	TEST_INST("66ba0080"                , mov(dx, -32768)                          );
	TEST_INST("66ba7f00"                , mov(dx, 127)                             );
	TEST_INST("66ba80ff"                , mov(dx, -128)                            );
	TEST_INST("66bb0000"                , mov(bx, 0)                               );
	TEST_INST("66bbff7f"                , mov(bx, 32767)                           );
	TEST_INST("66bb0080"                , mov(bx, -32768)                          );
	TEST_INST("66bb7f00"                , mov(bx, 127)                             );
	TEST_INST("66bb80ff"                , mov(bx, -128)                            );
	TEST_INST("6641bf0000"              , mov(r15w, 0)                             );
	TEST_INST("6641bfff7f"              , mov(r15w, 32767)                         );
	TEST_INST("6641bf0080"              , mov(r15w, -32768)                        );
	TEST_INST("6641bf7f00"              , mov(r15w, 127)                           );
	TEST_INST("6641bf80ff"              , mov(r15w, -128)                          );
	TEST_INST("b900000000"              , mov(ecx, 0)                              );
	TEST_INST("b9ffffff7f"              , mov(ecx, 2147483647)                     );
	TEST_INST("b900000080"              , mov(ecx, -2147483648)                    );
	TEST_INST("b9ff7f0000"              , mov(ecx, 32767)                          );
	TEST_INST("b90080ffff"              , mov(ecx, -32768)                         );
	TEST_INST("b97f000000"              , mov(ecx, 127)                            );
	TEST_INST("b980ffffff"              , mov(ecx, -128)                           );
	TEST_INST("ba00000000"              , mov(edx, 0)                              );
	TEST_INST("baffffff7f"              , mov(edx, 2147483647)                     );
	TEST_INST("ba00000080"              , mov(edx, -2147483648)                    );
	TEST_INST("baff7f0000"              , mov(edx, 32767)                          );
	TEST_INST("ba0080ffff"              , mov(edx, -32768)                         );
	TEST_INST("ba7f000000"              , mov(edx, 127)                            );
	TEST_INST("ba80ffffff"              , mov(edx, -128)                           );
	TEST_INST("88c9"                    , mov(cl, cl)                              );
	TEST_INST("88d1"                    , mov(cl, dl)                              );
	TEST_INST("88d9"                    , mov(cl, bl)                              );
	TEST_INST("88ca"                    , mov(dl, cl)                              );
	TEST_INST("88d2"                    , mov(dl, dl)                              );
	TEST_INST("88da"                    , mov(dl, bl)                              );
	TEST_INST("88cb"                    , mov(bl, cl)                              );
	TEST_INST("88d3"                    , mov(bl, dl)                              );
	TEST_INST("88db"                    , mov(bl, bl)                              );
	TEST_INST("880dfaffffff"            , mov(mem8::ptr(rip, 0x0), cl)             );
	TEST_INST("8815faffffff"            , mov(mem8::ptr(rip, 0x0), dl)             );
	TEST_INST("881dfaffffff"            , mov(mem8::ptr(rip, 0x0), bl)             );
	TEST_INST("880df9000000"            , mov(mem8::ptr(rip, 0xFF), cl)            );
	TEST_INST("8815f9000000"            , mov(mem8::ptr(rip, 0xFF), dl)            );
	TEST_INST("881df9000000"            , mov(mem8::ptr(rip, 0xFF), bl)            );
	TEST_INST("880df9ff0000"            , mov(mem8::ptr(rip, 0xFFFF), cl)          );
	TEST_INST("8815f9ff0000"            , mov(mem8::ptr(rip, 0xFFFF), dl)          );
	TEST_INST("881df9ff0000"            , mov(mem8::ptr(rip, 0xFFFF), bl)          );
	TEST_INST("8808"                    , mov(mem8::ptr(rax), cl)                  );
	TEST_INST("8810"                    , mov(mem8::ptr(rax), dl)                  );
	TEST_INST("8818"                    , mov(mem8::ptr(rax), bl)                  );
	TEST_INST("8808"                    , mov(mem8::ptr(rax, 0x0), cl)             );
	TEST_INST("8810"                    , mov(mem8::ptr(rax, 0x0), dl)             );
	TEST_INST("8818"                    , mov(mem8::ptr(rax, 0x0), bl)             );
	TEST_INST("8888ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), cl)          );
	TEST_INST("8890ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), dl)          );
	TEST_INST("8898ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), bl)          );
	TEST_INST("8808"                    , mov(mem8::ptr(rax, 0x0), cl)             );
	TEST_INST("8810"                    , mov(mem8::ptr(rax, 0x0), dl)             );
	TEST_INST("8818"                    , mov(mem8::ptr(rax, 0x0), bl)             );
	TEST_INST("8888ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), cl)          );
	TEST_INST("8890ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), dl)          );
	TEST_INST("8898ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), bl)          );
	TEST_INST("8888ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), cl)          );
	TEST_INST("8890ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), dl)          );
	TEST_INST("8898ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), bl)          );
	TEST_INST("8888ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), cl)          );
	TEST_INST("8890ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), dl)          );
	TEST_INST("8898ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), bl)          );
	TEST_INST("8888ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), cl)          );
	TEST_INST("8890ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), dl)          );
	TEST_INST("8898ffff0000"            , mov(mem8::ptr(rax, 0xFFFF), bl)          );
	TEST_INST("888c24ffff0000"          , mov(mem8::ptr(rsp, 0xFFFF), cl)          );
	TEST_INST("889424ffff0000"          , mov(mem8::ptr(rsp, 0xFFFF), dl)          );
	TEST_INST("889c24ffff0000"          , mov(mem8::ptr(rsp, 0xFFFF), bl)          );
	TEST_INST("6689c9"                  , mov(cx, cx)                              );
	TEST_INST("6689d1"                  , mov(cx, dx)                              );
	TEST_INST("6689d9"                  , mov(cx, bx)                              );
	TEST_INST("664489f9"                , mov(cx, r15w)                            );
	TEST_INST("6689ca"                  , mov(dx, cx)                              );
	TEST_INST("6689d2"                  , mov(dx, dx)                              );
	TEST_INST("6689da"                  , mov(dx, bx)                              );
	TEST_INST("664489fa"                , mov(dx, r15w)                            );
	TEST_INST("6689cb"                  , mov(bx, cx)                              );
	TEST_INST("6689d3"                  , mov(bx, dx)                              );
	TEST_INST("6689db"                  , mov(bx, bx)                              );
	TEST_INST("664489fb"                , mov(bx, r15w)                            );
	TEST_INST("664189cf"                , mov(r15w, cx)                            );
	TEST_INST("664189d7"                , mov(r15w, dx)                            );
	TEST_INST("664189df"                , mov(r15w, bx)                            );
	TEST_INST("664589ff"                , mov(r15w, r15w)                          );
	TEST_INST("66890df9ffffff"          , mov(mem16::ptr(rip, 0x0), cx)            );
	TEST_INST("668915f9ffffff"          , mov(mem16::ptr(rip, 0x0), dx)            );
	TEST_INST("66891df9ffffff"          , mov(mem16::ptr(rip, 0x0), bx)            );
	TEST_INST("6644893df8ffffff"        , mov(mem16::ptr(rip, 0x0), r15w)          );
	TEST_INST("66890df8000000"          , mov(mem16::ptr(rip, 0xFF), cx)           );
	TEST_INST("668915f8000000"          , mov(mem16::ptr(rip, 0xFF), dx)           );
	TEST_INST("66891df8000000"          , mov(mem16::ptr(rip, 0xFF), bx)           );
	TEST_INST("6644893df7000000"        , mov(mem16::ptr(rip, 0xFF), r15w)         );
	TEST_INST("66890df8ff0000"          , mov(mem16::ptr(rip, 0xFFFF), cx)         );
	TEST_INST("668915f8ff0000"          , mov(mem16::ptr(rip, 0xFFFF), dx)         );
	TEST_INST("66891df8ff0000"          , mov(mem16::ptr(rip, 0xFFFF), bx)         );
	TEST_INST("6644893df7ff0000"        , mov(mem16::ptr(rip, 0xFFFF), r15w)       );
	TEST_INST("668908"                  , mov(mem16::ptr(rax), cx)                 );
	TEST_INST("668910"                  , mov(mem16::ptr(rax), dx)                 );
	TEST_INST("668918"                  , mov(mem16::ptr(rax), bx)                 );
	TEST_INST("66448938"                , mov(mem16::ptr(rax), r15w)               );
	TEST_INST("668908"                  , mov(mem16::ptr(rax, 0x0), cx)            );
	TEST_INST("668910"                  , mov(mem16::ptr(rax, 0x0), dx)            );
	TEST_INST("668918"                  , mov(mem16::ptr(rax, 0x0), bx)            );
	TEST_INST("66448938"                , mov(mem16::ptr(rax, 0x0), r15w)          );
	TEST_INST("668988ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), cx)         );
	TEST_INST("668990ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), dx)         );
	TEST_INST("668998ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), bx)         );
	TEST_INST("664489b8ffff0000"        , mov(mem16::ptr(rax, 0xFFFF), r15w)       );
	TEST_INST("668908"                  , mov(mem16::ptr(rax, 0x0), cx)            );
	TEST_INST("668910"                  , mov(mem16::ptr(rax, 0x0), dx)            );
	TEST_INST("668918"                  , mov(mem16::ptr(rax, 0x0), bx)            );
	TEST_INST("66448938"                , mov(mem16::ptr(rax, 0x0), r15w)          );
	TEST_INST("668988ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), cx)         );
	TEST_INST("668990ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), dx)         );
	TEST_INST("668998ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), bx)         );
	TEST_INST("664489b8ffff0000"        , mov(mem16::ptr(rax, 0xFFFF), r15w)       );
	TEST_INST("668988ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), cx)         );
	TEST_INST("668990ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), dx)         );
	TEST_INST("668998ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), bx)         );
	TEST_INST("664489b8ffff0000"        , mov(mem16::ptr(rax, 0xFFFF), r15w)       );
	TEST_INST("668988ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), cx)         );
	TEST_INST("668990ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), dx)         );
	TEST_INST("668998ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), bx)         );
	TEST_INST("664489b8ffff0000"        , mov(mem16::ptr(rax, 0xFFFF), r15w)       );
	TEST_INST("668988ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), cx)         );
	TEST_INST("668990ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), dx)         );
	TEST_INST("668998ffff0000"          , mov(mem16::ptr(rax, 0xFFFF), bx)         );
	TEST_INST("664489b8ffff0000"        , mov(mem16::ptr(rax, 0xFFFF), r15w)       );
	TEST_INST("66898c24ffff0000"        , mov(mem16::ptr(rsp, 0xFFFF), cx)         );
	TEST_INST("66899424ffff0000"        , mov(mem16::ptr(rsp, 0xFFFF), dx)         );
	TEST_INST("66899c24ffff0000"        , mov(mem16::ptr(rsp, 0xFFFF), bx)         );
	TEST_INST("664489bc24ffff0000"      , mov(mem16::ptr(rsp, 0xFFFF), r15w)       );
	TEST_INST("89c9"                    , mov(ecx, ecx)                            );
	TEST_INST("89d1"                    , mov(ecx, edx)                            );
	TEST_INST("89d9"                    , mov(ecx, ebx)                            );
	TEST_INST("4489f9"                  , mov(ecx, r15d)                           );
	TEST_INST("89ca"                    , mov(edx, ecx)                            );
	TEST_INST("89d2"                    , mov(edx, edx)                            );
	TEST_INST("66c780ffff000080ff"      , mov(mem16::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("66c7000000"              , mov(mem16::ptr(rax, 0x0), 0)             );
	TEST_INST("66c700ff7f"              , mov(mem16::ptr(rax, 0x0), 32767)         );
	TEST_INST("66c7000080"              , mov(mem16::ptr(rax, 0x0), -32768)        );
	TEST_INST("66c7007f00"              , mov(mem16::ptr(rax, 0x0), 127)           );
	TEST_INST("66c70080ff"              , mov(mem16::ptr(rax, 0x0), -128)          );
	TEST_INST("66c780ffff00000000"      , mov(mem16::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("66c780ffff0000ff7f"      , mov(mem16::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("66c780ffff00000080"      , mov(mem16::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("66c780ffff00007f00"      , mov(mem16::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("66c780ffff000080ff"      , mov(mem16::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("66c780ffff00000000"      , mov(mem16::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("66c780ffff0000ff7f"      , mov(mem16::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("66c780ffff00000080"      , mov(mem16::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("66c780ffff00007f00"      , mov(mem16::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("66c780ffff000080ff"      , mov(mem16::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("66c780ffff00000000"      , mov(mem16::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("66c780ffff0000ff7f"      , mov(mem16::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("66c780ffff00000080"      , mov(mem16::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("66c780ffff00007f00"      , mov(mem16::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("66c780ffff000080ff"      , mov(mem16::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("66c780ffff00000000"      , mov(mem16::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("66c780ffff0000ff7f"      , mov(mem16::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("66c780ffff00000080"      , mov(mem16::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("66c780ffff00007f00"      , mov(mem16::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("66c780ffff000080ff"      , mov(mem16::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("66c78424ffff00000000"    , mov(mem16::ptr(rsp, 0xFFFF), 0)          );
	TEST_INST("66c78424ffff0000ff7f"    , mov(mem16::ptr(rsp, 0xFFFF), 32767)      );
	TEST_INST("66c78424ffff00000080"    , mov(mem16::ptr(rsp, 0xFFFF), -32768)     );
	TEST_INST("66c78424ffff00007f00"    , mov(mem16::ptr(rsp, 0xFFFF), 127)        );
	TEST_INST("66c78424ffff000080ff"    , mov(mem16::ptr(rsp, 0xFFFF), -128)       );
	TEST_INST("c705f6ffffff00000000"    , mov(mem32::ptr(rip, 0x0), 0)             );
	TEST_INST("c705f6ffffffffffff7f"    , mov(mem32::ptr(rip, 0x0), 2147483647)    );
	TEST_INST("c705f6ffffff00000080"    , mov(mem32::ptr(rip, 0x0), -2147483648)   );
	TEST_INST("c705f6ffffffff7f0000"    , mov(mem32::ptr(rip, 0x0), 32767)         );
	TEST_INST("c705f6ffffff0080ffff"    , mov(mem32::ptr(rip, 0x0), -32768)        );
	TEST_INST("c705f6ffffff7f000000"    , mov(mem32::ptr(rip, 0x0), 127)           );
	TEST_INST("c705f6ffffff80ffffff"    , mov(mem32::ptr(rip, 0x0), -128)          );
	TEST_INST("c705f500000000000000"    , mov(mem32::ptr(rip, 0xFF), 0)            );
	TEST_INST("c705f5000000ffffff7f"    , mov(mem32::ptr(rip, 0xFF), 2147483647)   );
	TEST_INST("c705f500000000000080"    , mov(mem32::ptr(rip, 0xFF), -2147483648)  );
	TEST_INST("c705f5000000ff7f0000"    , mov(mem32::ptr(rip, 0xFF), 32767)        );
	TEST_INST("c705f50000000080ffff"    , mov(mem32::ptr(rip, 0xFF), -32768)       );
	TEST_INST("c705f50000007f000000"    , mov(mem32::ptr(rip, 0xFF), 127)          );
	TEST_INST("c705f500000080ffffff"    , mov(mem32::ptr(rip, 0xFF), -128)         );
	TEST_INST("c705f5ff000000000000"    , mov(mem32::ptr(rip, 0xFFFF), 0)          );
	TEST_INST("c705f5ff0000ffffff7f"    , mov(mem32::ptr(rip, 0xFFFF), 2147483647) );
	TEST_INST("c705f5ff000000000080"    , mov(mem32::ptr(rip, 0xFFFF), -2147483648));
	TEST_INST("c705f5ff0000ff7f0000"    , mov(mem32::ptr(rip, 0xFFFF), 32767)      );
	TEST_INST("c705f5ff00000080ffff"    , mov(mem32::ptr(rip, 0xFFFF), -32768)     );
	TEST_INST("c705f5ff00007f000000"    , mov(mem32::ptr(rip, 0xFFFF), 127)        );
	TEST_INST("c705f5ff000080ffffff"    , mov(mem32::ptr(rip, 0xFFFF), -128)       );
	TEST_INST("c70000000000"            , mov(mem32::ptr(rax), 0)                  );
	TEST_INST("c700ffffff7f"            , mov(mem32::ptr(rax), 2147483647)         );
	TEST_INST("c70000000080"            , mov(mem32::ptr(rax), -2147483648)        );
	TEST_INST("c700ff7f0000"            , mov(mem32::ptr(rax), 32767)              );
	TEST_INST("c7000080ffff"            , mov(mem32::ptr(rax), -32768)             );
	TEST_INST("c7007f000000"            , mov(mem32::ptr(rax), 127)                );
	TEST_INST("c70080ffffff"            , mov(mem32::ptr(rax), -128)               );
	TEST_INST("c70000000000"            , mov(mem32::ptr(rax, 0x0), 0)             );
	TEST_INST("c700ffffff7f"            , mov(mem32::ptr(rax, 0x0), 2147483647)    );
	TEST_INST("c70000000080"            , mov(mem32::ptr(rax, 0x0), -2147483648)   );
	TEST_INST("c700ff7f0000"            , mov(mem32::ptr(rax, 0x0), 32767)         );
	TEST_INST("c7000080ffff"            , mov(mem32::ptr(rax, 0x0), -32768)        );
	TEST_INST("c7007f000000"            , mov(mem32::ptr(rax, 0x0), 127)           );
	TEST_INST("c70080ffffff"            , mov(mem32::ptr(rax, 0x0), -128)          );
	TEST_INST("c780ffff000000000000"    , mov(mem32::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("c780ffff0000ffffff7f"    , mov(mem32::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("c780ffff000000000080"    , mov(mem32::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("c780ffff0000ff7f0000"    , mov(mem32::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("c780ffff00000080ffff"    , mov(mem32::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("c780ffff00007f000000"    , mov(mem32::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("c780ffff000080ffffff"    , mov(mem32::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("c70000000000"            , mov(mem32::ptr(rax, 0x0), 0)             );
	TEST_INST("c700ffffff7f"            , mov(mem32::ptr(rax, 0x0), 2147483647)    );
	TEST_INST("c70000000080"            , mov(mem32::ptr(rax, 0x0), -2147483648)   );
	TEST_INST("c700ff7f0000"            , mov(mem32::ptr(rax, 0x0), 32767)         );
	TEST_INST("c7000080ffff"            , mov(mem32::ptr(rax, 0x0), -32768)        );
	TEST_INST("c7007f000000"            , mov(mem32::ptr(rax, 0x0), 127)           );
	TEST_INST("c70080ffffff"            , mov(mem32::ptr(rax, 0x0), -128)          );
	TEST_INST("c780ffff000000000000"    , mov(mem32::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("c780ffff0000ffffff7f"    , mov(mem32::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("c780ffff000000000080"    , mov(mem32::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("c780ffff0000ff7f0000"    , mov(mem32::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("c780ffff00000080ffff"    , mov(mem32::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("c780ffff00007f000000"    , mov(mem32::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("c780ffff000080ffffff"    , mov(mem32::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("c780ffff000000000000"    , mov(mem32::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("c780ffff0000ffffff7f"    , mov(mem32::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("c780ffff000000000080"    , mov(mem32::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("c780ffff0000ff7f0000"    , mov(mem32::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("c780ffff00000080ffff"    , mov(mem32::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("c780ffff00007f000000"    , mov(mem32::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("c780ffff000080ffffff"    , mov(mem32::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("c780ffff000000000000"    , mov(mem32::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("c780ffff0000ffffff7f"    , mov(mem32::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("c780ffff000000000080"    , mov(mem32::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("c780ffff0000ff7f0000"    , mov(mem32::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("c780ffff00000080ffff"    , mov(mem32::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("c780ffff00007f000000"    , mov(mem32::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("c780ffff000080ffffff"    , mov(mem32::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("c780ffff000000000000"    , mov(mem32::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("c780ffff0000ffffff7f"    , mov(mem32::ptr(rax, 0xFFFF), 2147483647) );
	TEST_INST("c780ffff000000000080"    , mov(mem32::ptr(rax, 0xFFFF), -2147483648));
	TEST_INST("c780ffff0000ff7f0000"    , mov(mem32::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("c780ffff00000080ffff"    , mov(mem32::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("c780ffff00007f000000"    , mov(mem32::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("c780ffff000080ffffff"    , mov(mem32::ptr(rax, 0xFFFF), -128)       );
	TEST_INST("c78424ffff000000000000"  , mov(mem32::ptr(rsp, 0xFFFF), 0)          );
	TEST_INST("c78424ffff0000ffffff7f"  , mov(mem32::ptr(rsp, 0xFFFF), 2147483647) );
	TEST_INST("c78424ffff000000000080"  , mov(mem32::ptr(rsp, 0xFFFF), -2147483648));
	TEST_INST("c78424ffff0000ff7f0000"  , mov(mem32::ptr(rsp, 0xFFFF), 32767)      );
	TEST_INST("c78424ffff00000080ffff"  , mov(mem32::ptr(rsp, 0xFFFF), -32768)     );
	TEST_INST("c78424ffff00007f000000"  , mov(mem32::ptr(rsp, 0xFFFF), 127)        );
	TEST_INST("c78424ffff000080ffffff"  , mov(mem32::ptr(rsp, 0xFFFF), -128)       );
	TEST_INST("bb00000000"              , mov(ebx, 0)                              );
	TEST_INST("bbffffff7f"              , mov(ebx, 2147483647)                     );
	TEST_INST("bb00000080"              , mov(ebx, -2147483648)                    );
	TEST_INST("bbff7f0000"              , mov(ebx, 32767)                          );
	TEST_INST("bb0080ffff"              , mov(ebx, -32768)                         );
	TEST_INST("bb7f000000"              , mov(ebx, 127)                            );
	TEST_INST("bb80ffffff"              , mov(ebx, -128)                           );
	TEST_INST("41bf00000000"            , mov(r15d, 0)                             );
	TEST_INST("41bfffffff7f"            , mov(r15d, 2147483647)                    );
	TEST_INST("41bf00000080"            , mov(r15d, -2147483648)                   );
	TEST_INST("41bfff7f0000"            , mov(r15d, 32767)                         );
	TEST_INST("41bf0080ffff"            , mov(r15d, -32768)                        );
	TEST_INST("41bf7f000000"            , mov(r15d, 127)                           );
	TEST_INST("41bf80ffffff"            , mov(r15d, -128)                          );
	TEST_INST("b900000000"              , mov(rcx, 0)                              );
	TEST_INST("48b9ffffffffffffff7f"    , mov(rcx, 9223372036854775807)            );
	TEST_INST("48b90000000000000080"    , mov(rcx, -9223372036854775807 - 1)       );
	TEST_INST("b9ffffff7f"              , mov(rcx, 2147483647)                     );
	TEST_INST("48c7c100000080"          , mov(rcx, -2147483648)                    );
	TEST_INST("b9ff7f0000"              , mov(rcx, 32767)                          );
	TEST_INST("48c7c10080ffff"          , mov(rcx, -32768)                         );
	TEST_INST("b97f000000"              , mov(rcx, 127)                            );
	TEST_INST("48c7c180ffffff"          , mov(rcx, -128)                           );
	TEST_INST("ba00000000"              , mov(rdx, 0)                              );
	TEST_INST("48baffffffffffffff7f"    , mov(rdx, 9223372036854775807)            );
	TEST_INST("48ba0000000000000080"    , mov(rdx, -9223372036854775807 - 1)       );
	TEST_INST("baffffff7f"              , mov(rdx, 2147483647)                     );
	TEST_INST("48c7c200000080"          , mov(rdx, -2147483648)                    );
	TEST_INST("baff7f0000"              , mov(rdx, 32767)                          );
	TEST_INST("48c7c20080ffff"          , mov(rdx, -32768)                         );
	TEST_INST("ba7f000000"              , mov(rdx, 127)                            );
	TEST_INST("48c7c280ffffff"          , mov(rdx, -128)                           );
	TEST_INST("bb00000000"              , mov(rbx, 0)                              );
	TEST_INST("48bbffffffffffffff7f"    , mov(rbx, 9223372036854775807)            );
	TEST_INST("48bb0000000000000080"    , mov(rbx, -9223372036854775807 - 1)       );
	TEST_INST("bbffffff7f"              , mov(rbx, 2147483647)                     );
	TEST_INST("48c7c300000080"          , mov(rbx, -2147483648)                    );
	TEST_INST("bbff7f0000"              , mov(rbx, 32767)                          );
	TEST_INST("48c7c30080ffff"          , mov(rbx, -32768)                         );
	TEST_INST("bb7f000000"              , mov(rbx, 127)                            );
	TEST_INST("48c7c380ffffff"          , mov(rbx, -128)                           );
	TEST_INST("41bf00000000"            , mov(r15, 0)                              );
	TEST_INST("49bfffffffffffffff7f"    , mov(r15, 9223372036854775807)            );
	TEST_INST("49bf0000000000000080"    , mov(r15, -9223372036854775807 - 1)       );
	TEST_INST("41bfffffff7f"            , mov(r15, 2147483647)                     );
	TEST_INST("49c7c700000080"          , mov(r15, -2147483648)                    );
	TEST_INST("41bfff7f0000"            , mov(r15, 32767)                          );
	TEST_INST("49c7c70080ffff"          , mov(r15, -32768)                         );
	TEST_INST("41bf7f000000"            , mov(r15, 127)                            );
	TEST_INST("49c7c780ffffff"          , mov(r15, -128)                           );
	TEST_INST("c605f9ffffff00"          , mov(mem8::ptr(rip, 0x0), 0)              );
	TEST_INST("c605f9ffffff7f"          , mov(mem8::ptr(rip, 0x0), 127)            );
	TEST_INST("c605f9ffffff80"          , mov(mem8::ptr(rip, 0x0), -128)           );
	TEST_INST("c605f800000000"          , mov(mem8::ptr(rip, 0xFF), 0)             );
	TEST_INST("c605f80000007f"          , mov(mem8::ptr(rip, 0xFF), 127)           );
	TEST_INST("c605f800000080"          , mov(mem8::ptr(rip, 0xFF), -128)          );
	TEST_INST("c605f8ff000000"          , mov(mem8::ptr(rip, 0xFFFF), 0)           );
	TEST_INST("c605f8ff00007f"          , mov(mem8::ptr(rip, 0xFFFF), 127)         );
	TEST_INST("c605f8ff000080"          , mov(mem8::ptr(rip, 0xFFFF), -128)        );
	TEST_INST("c60000"                  , mov(mem8::ptr(rax), 0)                   );
	TEST_INST("c6007f"                  , mov(mem8::ptr(rax), 127)                 );
	TEST_INST("c60080"                  , mov(mem8::ptr(rax), -128)                );
	TEST_INST("c60000"                  , mov(mem8::ptr(rax, 0x0), 0)              );
	TEST_INST("c6007f"                  , mov(mem8::ptr(rax, 0x0), 127)            );
	TEST_INST("c60080"                  , mov(mem8::ptr(rax, 0x0), -128)           );
	TEST_INST("c680ffff000000"          , mov(mem8::ptr(rax, 0xFFFF), 0)           );
	TEST_INST("c680ffff00007f"          , mov(mem8::ptr(rax, 0xFFFF), 127)         );
	TEST_INST("c680ffff000080"          , mov(mem8::ptr(rax, 0xFFFF), -128)        );
	TEST_INST("c60000"                  , mov(mem8::ptr(rax, 0x0), 0)              );
	TEST_INST("c6007f"                  , mov(mem8::ptr(rax, 0x0), 127)            );
	TEST_INST("c60080"                  , mov(mem8::ptr(rax, 0x0), -128)           );
	TEST_INST("c680ffff000000"          , mov(mem8::ptr(rax, 0xFFFF), 0)           );
	TEST_INST("c680ffff00007f"          , mov(mem8::ptr(rax, 0xFFFF), 127)         );
	TEST_INST("c680ffff000080"          , mov(mem8::ptr(rax, 0xFFFF), -128)        );
	TEST_INST("c680ffff000000"          , mov(mem8::ptr(rax, 0xFFFF), 0)           );
	TEST_INST("c680ffff00007f"          , mov(mem8::ptr(rax, 0xFFFF), 127)         );
	TEST_INST("c680ffff000080"          , mov(mem8::ptr(rax, 0xFFFF), -128)        );
	TEST_INST("c680ffff000000"          , mov(mem8::ptr(rax, 0xFFFF), 0)           );
	TEST_INST("c680ffff00007f"          , mov(mem8::ptr(rax, 0xFFFF), 127)         );
	TEST_INST("c680ffff000080"          , mov(mem8::ptr(rax, 0xFFFF), -128)        );
	TEST_INST("c680ffff000000"          , mov(mem8::ptr(rax, 0xFFFF), 0)           );
	TEST_INST("c680ffff00007f"          , mov(mem8::ptr(rax, 0xFFFF), 127)         );
	TEST_INST("c680ffff000080"          , mov(mem8::ptr(rax, 0xFFFF), -128)        );
	TEST_INST("c68424ffff000000"        , mov(mem8::ptr(rsp, 0xFFFF), 0)           );
	TEST_INST("c68424ffff00007f"        , mov(mem8::ptr(rsp, 0xFFFF), 127)         );
	TEST_INST("c68424ffff000080"        , mov(mem8::ptr(rsp, 0xFFFF), -128)        );
	TEST_INST("66c705f7ffffff0000"      , mov(mem16::ptr(rip, 0x0), 0)             );
	TEST_INST("66c705f7ffffffff7f"      , mov(mem16::ptr(rip, 0x0), 32767)         );
	TEST_INST("66c705f7ffffff0080"      , mov(mem16::ptr(rip, 0x0), -32768)        );
	TEST_INST("66c705f7ffffff7f00"      , mov(mem16::ptr(rip, 0x0), 127)           );
	TEST_INST("66c705f7ffffff80ff"      , mov(mem16::ptr(rip, 0x0), -128)          );
	TEST_INST("66c705f60000000000"      , mov(mem16::ptr(rip, 0xFF), 0)            );
	TEST_INST("66c705f6000000ff7f"      , mov(mem16::ptr(rip, 0xFF), 32767)        );
	TEST_INST("66c705f60000000080"      , mov(mem16::ptr(rip, 0xFF), -32768)       );
	TEST_INST("66c705f60000007f00"      , mov(mem16::ptr(rip, 0xFF), 127)          );
	TEST_INST("66c705f600000080ff"      , mov(mem16::ptr(rip, 0xFF), -128)         );
	TEST_INST("66c705f6ff00000000"      , mov(mem16::ptr(rip, 0xFFFF), 0)          );
	TEST_INST("66c705f6ff0000ff7f"      , mov(mem16::ptr(rip, 0xFFFF), 32767)      );
	TEST_INST("66c705f6ff00000080"      , mov(mem16::ptr(rip, 0xFFFF), -32768)     );
	TEST_INST("66c705f6ff00007f00"      , mov(mem16::ptr(rip, 0xFFFF), 127)        );
	TEST_INST("66c705f6ff000080ff"      , mov(mem16::ptr(rip, 0xFFFF), -128)       );
	TEST_INST("66c7000000"              , mov(mem16::ptr(rax), 0)                  );
	TEST_INST("66c700ff7f"              , mov(mem16::ptr(rax), 32767)              );
	TEST_INST("66c7000080"              , mov(mem16::ptr(rax), -32768)             );
	TEST_INST("66c7007f00"              , mov(mem16::ptr(rax), 127)                );
	TEST_INST("66c70080ff"              , mov(mem16::ptr(rax), -128)               );
	TEST_INST("66c7000000"              , mov(mem16::ptr(rax, 0x0), 0)             );
	TEST_INST("66c700ff7f"              , mov(mem16::ptr(rax, 0x0), 32767)         );
	TEST_INST("66c7000080"              , mov(mem16::ptr(rax, 0x0), -32768)        );
	TEST_INST("66c7007f00"              , mov(mem16::ptr(rax, 0x0), 127)           );
	TEST_INST("66c70080ff"              , mov(mem16::ptr(rax, 0x0), -128)          );
	TEST_INST("66c780ffff00000000"      , mov(mem16::ptr(rax, 0xFFFF), 0)          );
	TEST_INST("66c780ffff0000ff7f"      , mov(mem16::ptr(rax, 0xFFFF), 32767)      );
	TEST_INST("66c780ffff00000080"      , mov(mem16::ptr(rax, 0xFFFF), -32768)     );
	TEST_INST("66c780ffff00007f00"      , mov(mem16::ptr(rax, 0xFFFF), 127)        );
	TEST_INST("488990ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rdx)        );
	TEST_INST("488998ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rbx)        );
	TEST_INST("4c89b8ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), r15)        );
	TEST_INST("48898c24ffff0000"        , mov(mem64::ptr(rsp, 0xFFFF), rcx)        );
	TEST_INST("48899424ffff0000"        , mov(mem64::ptr(rsp, 0xFFFF), rdx)        );
	TEST_INST("48899c24ffff0000"        , mov(mem64::ptr(rsp, 0xFFFF), rbx)        );
	TEST_INST("4c89bc24ffff0000"        , mov(mem64::ptr(rsp, 0xFFFF), r15)        );
	TEST_INST("8a0dfaffffff"            , mov(cl, mem8::ptr(rip, 0x0))             );
	TEST_INST("8a0df9000000"            , mov(cl, mem8::ptr(rip, 0xFF))            );
	TEST_INST("8a0df9ff0000"            , mov(cl, mem8::ptr(rip, 0xFFFF))          );
	TEST_INST("8a08"                    , mov(cl, mem8::ptr(rax))                  );
	TEST_INST("8a08"                    , mov(cl, mem8::ptr(rax, 0x0))             );
	TEST_INST("8a88ffff0000"            , mov(cl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a08"                    , mov(cl, mem8::ptr(rax, 0x0))             );
	TEST_INST("8a88ffff0000"            , mov(cl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a88ffff0000"            , mov(cl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a88ffff0000"            , mov(cl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a88ffff0000"            , mov(cl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a8c24ffff0000"          , mov(cl, mem8::ptr(rsp, 0xFFFF))          );
	TEST_INST("8a15faffffff"            , mov(dl, mem8::ptr(rip, 0x0))             );
	TEST_INST("8a15f9000000"            , mov(dl, mem8::ptr(rip, 0xFF))            );
	TEST_INST("8a15f9ff0000"            , mov(dl, mem8::ptr(rip, 0xFFFF))          );
	TEST_INST("8a10"                    , mov(dl, mem8::ptr(rax))                  );
	TEST_INST("8a10"                    , mov(dl, mem8::ptr(rax, 0x0))             );
	TEST_INST("8a90ffff0000"            , mov(dl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a10"                    , mov(dl, mem8::ptr(rax, 0x0))             );
	TEST_INST("8a90ffff0000"            , mov(dl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a90ffff0000"            , mov(dl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a90ffff0000"            , mov(dl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a90ffff0000"            , mov(dl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a9424ffff0000"          , mov(dl, mem8::ptr(rsp, 0xFFFF))          );
	TEST_INST("8a1dfaffffff"            , mov(bl, mem8::ptr(rip, 0x0))             );
	TEST_INST("8a1df9000000"            , mov(bl, mem8::ptr(rip, 0xFF))            );
	TEST_INST("8a1df9ff0000"            , mov(bl, mem8::ptr(rip, 0xFFFF))          );
	TEST_INST("8a18"                    , mov(bl, mem8::ptr(rax))                  );
	TEST_INST("8a18"                    , mov(bl, mem8::ptr(rax, 0x0))             );
	TEST_INST("8a98ffff0000"            , mov(bl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a18"                    , mov(bl, mem8::ptr(rax, 0x0))             );
	TEST_INST("8a98ffff0000"            , mov(bl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a98ffff0000"            , mov(bl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a98ffff0000"            , mov(bl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a98ffff0000"            , mov(bl, mem8::ptr(rax, 0xFFFF))          );
	TEST_INST("8a9c24ffff0000"          , mov(bl, mem8::ptr(rsp, 0xFFFF))          );
	TEST_INST("668b0df9ffffff"          , mov(cx, mem16::ptr(rip, 0x0))            );
	TEST_INST("668b0df8000000"          , mov(cx, mem16::ptr(rip, 0xFF))           );
	TEST_INST("668b0df8ff0000"          , mov(cx, mem16::ptr(rip, 0xFFFF))         );
	TEST_INST("668b08"                  , mov(cx, mem16::ptr(rax))                 );
	TEST_INST("668b08"                  , mov(cx, mem16::ptr(rax, 0x0))            );
	TEST_INST("668b88ffff0000"          , mov(cx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b08"                  , mov(cx, mem16::ptr(rax, 0x0))            );
	TEST_INST("668b88ffff0000"          , mov(cx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b88ffff0000"          , mov(cx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b88ffff0000"          , mov(cx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b88ffff0000"          , mov(cx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b8c24ffff0000"        , mov(cx, mem16::ptr(rsp, 0xFFFF))         );
	TEST_INST("668b15f9ffffff"          , mov(dx, mem16::ptr(rip, 0x0))            );
	TEST_INST("668b15f8000000"          , mov(dx, mem16::ptr(rip, 0xFF))           );
	TEST_INST("668b15f8ff0000"          , mov(dx, mem16::ptr(rip, 0xFFFF))         );
	TEST_INST("668b10"                  , mov(dx, mem16::ptr(rax))                 );
	TEST_INST("668b10"                  , mov(dx, mem16::ptr(rax, 0x0))            );
	TEST_INST("668b90ffff0000"          , mov(dx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b10"                  , mov(dx, mem16::ptr(rax, 0x0))            );
	TEST_INST("668b90ffff0000"          , mov(dx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b90ffff0000"          , mov(dx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b90ffff0000"          , mov(dx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b90ffff0000"          , mov(dx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b9424ffff0000"        , mov(dx, mem16::ptr(rsp, 0xFFFF))         );
	TEST_INST("668b1df9ffffff"          , mov(bx, mem16::ptr(rip, 0x0))            );
	TEST_INST("668b1df8000000"          , mov(bx, mem16::ptr(rip, 0xFF))           );
	TEST_INST("668b1df8ff0000"          , mov(bx, mem16::ptr(rip, 0xFFFF))         );
	TEST_INST("668b18"                  , mov(bx, mem16::ptr(rax))                 );
	TEST_INST("668b18"                  , mov(bx, mem16::ptr(rax, 0x0))            );
	TEST_INST("668b98ffff0000"          , mov(bx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b18"                  , mov(bx, mem16::ptr(rax, 0x0))            );
	TEST_INST("668b98ffff0000"          , mov(bx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b98ffff0000"          , mov(bx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b98ffff0000"          , mov(bx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b98ffff0000"          , mov(bx, mem16::ptr(rax, 0xFFFF))         );
	TEST_INST("668b9c24ffff0000"        , mov(bx, mem16::ptr(rsp, 0xFFFF))         );
	TEST_INST("66448b3df8ffffff"        , mov(r15w, mem16::ptr(rip, 0x0))          );
	TEST_INST("66448b3df7000000"        , mov(r15w, mem16::ptr(rip, 0xFF))         );
	TEST_INST("66448b3df7ff0000"        , mov(r15w, mem16::ptr(rip, 0xFFFF))       );
	TEST_INST("66448b38"                , mov(r15w, mem16::ptr(rax))               );
	TEST_INST("66448b38"                , mov(r15w, mem16::ptr(rax, 0x0))          );
	TEST_INST("66448bb8ffff0000"        , mov(r15w, mem16::ptr(rax, 0xFFFF))       );
	TEST_INST("66448b38"                , mov(r15w, mem16::ptr(rax, 0x0))          );
	TEST_INST("66448bb8ffff0000"        , mov(r15w, mem16::ptr(rax, 0xFFFF))       );
	TEST_INST("66448bb8ffff0000"        , mov(r15w, mem16::ptr(rax, 0xFFFF))       );
	TEST_INST("66448bb8ffff0000"        , mov(r15w, mem16::ptr(rax, 0xFFFF))       );
	TEST_INST("66448bb8ffff0000"        , mov(r15w, mem16::ptr(rax, 0xFFFF))       );
	TEST_INST("66448bbc24ffff0000"      , mov(r15w, mem16::ptr(rsp, 0xFFFF))       );
	TEST_INST("8b0dfaffffff"            , mov(ecx, mem32::ptr(rip, 0x0))           );
	TEST_INST("8b0df9000000"            , mov(ecx, mem32::ptr(rip, 0xFF))          );
	TEST_INST("8b0df9ff0000"            , mov(ecx, mem32::ptr(rip, 0xFFFF))        );
	TEST_INST("8b08"                    , mov(ecx, mem32::ptr(rax))                );
	TEST_INST("8b08"                    , mov(ecx, mem32::ptr(rax, 0x0))           );
	TEST_INST("8b88ffff0000"            , mov(ecx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b08"                    , mov(ecx, mem32::ptr(rax, 0x0))           );
	TEST_INST("8b88ffff0000"            , mov(ecx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b88ffff0000"            , mov(ecx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b88ffff0000"            , mov(ecx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b88ffff0000"            , mov(ecx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b8c24ffff0000"          , mov(ecx, mem32::ptr(rsp, 0xFFFF))        );
	TEST_INST("8b15faffffff"            , mov(edx, mem32::ptr(rip, 0x0))           );
	TEST_INST("8b15f9000000"            , mov(edx, mem32::ptr(rip, 0xFF))          );
	TEST_INST("8b15f9ff0000"            , mov(edx, mem32::ptr(rip, 0xFFFF))        );
	TEST_INST("8b10"                    , mov(edx, mem32::ptr(rax))                );
	TEST_INST("8b10"                    , mov(edx, mem32::ptr(rax, 0x0))           );
	TEST_INST("8b90ffff0000"            , mov(edx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b10"                    , mov(edx, mem32::ptr(rax, 0x0))           );
	TEST_INST("8b90ffff0000"            , mov(edx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b90ffff0000"            , mov(edx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b90ffff0000"            , mov(edx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b90ffff0000"            , mov(edx, mem32::ptr(rax, 0xFFFF))        );
	TEST_INST("8b9424ffff0000"          , mov(edx, mem32::ptr(rsp, 0xFFFF))        );
	TEST_INST("89da"                    , mov(edx, ebx)                            );
	TEST_INST("4489fa"                  , mov(edx, r15d)                           );
	TEST_INST("89cb"                    , mov(ebx, ecx)                            );
	TEST_INST("89d3"                    , mov(ebx, edx)                            );
	TEST_INST("89db"                    , mov(ebx, ebx)                            );
	TEST_INST("4489fb"                  , mov(ebx, r15d)                           );
	TEST_INST("4189cf"                  , mov(r15d, ecx)                           );
	TEST_INST("4189d7"                  , mov(r15d, edx)                           );
	TEST_INST("4189df"                  , mov(r15d, ebx)                           );
	TEST_INST("4589ff"                  , mov(r15d, r15d)                          );
	TEST_INST("890dfaffffff"            , mov(mem32::ptr(rip, 0x0), ecx)           );
	TEST_INST("8915faffffff"            , mov(mem32::ptr(rip, 0x0), edx)           );
	TEST_INST("891dfaffffff"            , mov(mem32::ptr(rip, 0x0), ebx)           );
	TEST_INST("44893df9ffffff"          , mov(mem32::ptr(rip, 0x0), r15d)          );
	TEST_INST("890df9000000"            , mov(mem32::ptr(rip, 0xFF), ecx)          );
	TEST_INST("8915f9000000"            , mov(mem32::ptr(rip, 0xFF), edx)          );
	TEST_INST("891df9000000"            , mov(mem32::ptr(rip, 0xFF), ebx)          );
	TEST_INST("44893df8000000"          , mov(mem32::ptr(rip, 0xFF), r15d)         );
	TEST_INST("890df9ff0000"            , mov(mem32::ptr(rip, 0xFFFF), ecx)        );
	TEST_INST("8915f9ff0000"            , mov(mem32::ptr(rip, 0xFFFF), edx)        );
	TEST_INST("891df9ff0000"            , mov(mem32::ptr(rip, 0xFFFF), ebx)        );
	TEST_INST("44893df8ff0000"          , mov(mem32::ptr(rip, 0xFFFF), r15d)       );
	TEST_INST("8908"                    , mov(mem32::ptr(rax), ecx)                );
	TEST_INST("8910"                    , mov(mem32::ptr(rax), edx)                );
	TEST_INST("8918"                    , mov(mem32::ptr(rax), ebx)                );
	TEST_INST("448938"                  , mov(mem32::ptr(rax), r15d)               );
	TEST_INST("8908"                    , mov(mem32::ptr(rax, 0x0), ecx)           );
	TEST_INST("8910"                    , mov(mem32::ptr(rax, 0x0), edx)           );
	TEST_INST("8918"                    , mov(mem32::ptr(rax, 0x0), ebx)           );
	TEST_INST("448938"                  , mov(mem32::ptr(rax, 0x0), r15d)          );
	TEST_INST("8988ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ecx)        );
	TEST_INST("8990ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), edx)        );
	TEST_INST("8998ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ebx)        );
	TEST_INST("4489b8ffff0000"          , mov(mem32::ptr(rax, 0xFFFF), r15d)       );
	TEST_INST("8908"                    , mov(mem32::ptr(rax, 0x0), ecx)           );
	TEST_INST("8910"                    , mov(mem32::ptr(rax, 0x0), edx)           );
	TEST_INST("8918"                    , mov(mem32::ptr(rax, 0x0), ebx)           );
	TEST_INST("448938"                  , mov(mem32::ptr(rax, 0x0), r15d)          );
	TEST_INST("8988ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ecx)        );
	TEST_INST("8990ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), edx)        );
	TEST_INST("8998ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ebx)        );
	TEST_INST("4489b8ffff0000"          , mov(mem32::ptr(rax, 0xFFFF), r15d)       );
	TEST_INST("8988ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ecx)        );
	TEST_INST("8990ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), edx)        );
	TEST_INST("8998ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ebx)        );
	TEST_INST("4489b8ffff0000"          , mov(mem32::ptr(rax, 0xFFFF), r15d)       );
	TEST_INST("8988ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ecx)        );
	TEST_INST("8990ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), edx)        );
	TEST_INST("8998ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ebx)        );
	TEST_INST("4489b8ffff0000"          , mov(mem32::ptr(rax, 0xFFFF), r15d)       );
	TEST_INST("8988ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ecx)        );
	TEST_INST("8990ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), edx)        );
	TEST_INST("8998ffff0000"            , mov(mem32::ptr(rax, 0xFFFF), ebx)        );
	TEST_INST("4489b8ffff0000"          , mov(mem32::ptr(rax, 0xFFFF), r15d)       );
	TEST_INST("898c24ffff0000"          , mov(mem32::ptr(rsp, 0xFFFF), ecx)        );
	TEST_INST("899424ffff0000"          , mov(mem32::ptr(rsp, 0xFFFF), edx)        );
	TEST_INST("899c24ffff0000"          , mov(mem32::ptr(rsp, 0xFFFF), ebx)        );
	TEST_INST("4489bc24ffff0000"        , mov(mem32::ptr(rsp, 0xFFFF), r15d)       );
	TEST_INST("4889c9"                  , mov(rcx, rcx)                            );
	TEST_INST("4889d1"                  , mov(rcx, rdx)                            );
	TEST_INST("4889d9"                  , mov(rcx, rbx)                            );
	TEST_INST("4c89f9"                  , mov(rcx, r15)                            );
	TEST_INST("4889ca"                  , mov(rdx, rcx)                            );
	TEST_INST("4889d2"                  , mov(rdx, rdx)                            );
	TEST_INST("4889da"                  , mov(rdx, rbx)                            );
	TEST_INST("4c89fa"                  , mov(rdx, r15)                            );
	TEST_INST("4889cb"                  , mov(rbx, rcx)                            );
	TEST_INST("4889d3"                  , mov(rbx, rdx)                            );
	TEST_INST("4889db"                  , mov(rbx, rbx)                            );
	TEST_INST("4c89fb"                  , mov(rbx, r15)                            );
	TEST_INST("4989cf"                  , mov(r15, rcx)                            );
	TEST_INST("4989d7"                  , mov(r15, rdx)                            );
	TEST_INST("4989df"                  , mov(r15, rbx)                            );
	TEST_INST("4d89ff"                  , mov(r15, r15)                            );
	TEST_INST("48890df9ffffff"          , mov(mem64::ptr(rip, 0x0), rcx)           );
	TEST_INST("488915f9ffffff"          , mov(mem64::ptr(rip, 0x0), rdx)           );
	TEST_INST("48891df9ffffff"          , mov(mem64::ptr(rip, 0x0), rbx)           );
	TEST_INST("4c893df9ffffff"          , mov(mem64::ptr(rip, 0x0), r15)           );
	TEST_INST("48890df8000000"          , mov(mem64::ptr(rip, 0xFF), rcx)          );
	TEST_INST("488915f8000000"          , mov(mem64::ptr(rip, 0xFF), rdx)          );
	TEST_INST("48891df8000000"          , mov(mem64::ptr(rip, 0xFF), rbx)          );
	TEST_INST("4c893df8000000"          , mov(mem64::ptr(rip, 0xFF), r15)          );
	TEST_INST("48890df8ff0000"          , mov(mem64::ptr(rip, 0xFFFF), rcx)        );
	TEST_INST("488915f8ff0000"          , mov(mem64::ptr(rip, 0xFFFF), rdx)        );
	TEST_INST("48891df8ff0000"          , mov(mem64::ptr(rip, 0xFFFF), rbx)        );
	TEST_INST("4c893df8ff0000"          , mov(mem64::ptr(rip, 0xFFFF), r15)        );
	TEST_INST("488908"                  , mov(mem64::ptr(rax), rcx)                );
	TEST_INST("488910"                  , mov(mem64::ptr(rax), rdx)                );
	TEST_INST("488918"                  , mov(mem64::ptr(rax), rbx)                );
	TEST_INST("4c8938"                  , mov(mem64::ptr(rax), r15)                );
	TEST_INST("488908"                  , mov(mem64::ptr(rax, 0x0), rcx)           );
	TEST_INST("488910"                  , mov(mem64::ptr(rax, 0x0), rdx)           );
	TEST_INST("488918"                  , mov(mem64::ptr(rax, 0x0), rbx)           );
	TEST_INST("4c8938"                  , mov(mem64::ptr(rax, 0x0), r15)           );
	TEST_INST("488988ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rcx)        );
	TEST_INST("488990ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rdx)        );
	TEST_INST("488998ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rbx)        );
	TEST_INST("4c89b8ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), r15)        );
	TEST_INST("488908"                  , mov(mem64::ptr(rax, 0x0), rcx)           );
	TEST_INST("488910"                  , mov(mem64::ptr(rax, 0x0), rdx)           );
	TEST_INST("488918"                  , mov(mem64::ptr(rax, 0x0), rbx)           );
	TEST_INST("4c8938"                  , mov(mem64::ptr(rax, 0x0), r15)           );
	TEST_INST("488988ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rcx)        );
	TEST_INST("488990ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rdx)        );
	TEST_INST("488998ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rbx)        );
	TEST_INST("4c89b8ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), r15)        );
	TEST_INST("488988ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rcx)        );
	TEST_INST("488990ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rdx)        );
	TEST_INST("488998ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rbx)        );
	TEST_INST("4c89b8ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), r15)        );
	TEST_INST("488988ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rcx)        );
	TEST_INST("488990ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rdx)        );
	TEST_INST("488998ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rbx)        );
	TEST_INST("4c89b8ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), r15)        );
	TEST_INST("488988ffff0000"          , mov(mem64::ptr(rax, 0xFFFF), rcx)        );


	const u64 test_count = g_success_counter + g_fail_counter;
	const f64 elapsed = timer.get_elapsed<std::chrono::nanoseconds>();
	const u64 per_second = static_cast<u64>((static_cast<f64>(test_count) / elapsed) * 1'000'000'000);

	utility::console::print(
		"{}/{} tests passed ({}ms) ({} instructions per second)\n",
		g_success_counter,
		test_count,
		elapsed / 1'000'000, 
		per_second
	);
}

int main() {
	run_tests();
	using namespace baremetal;

	// TODO: add support for smaller destination reg indexing in generators
	// TODO: add warnings/error for incompatible imm sizes

	// assembler assembler;
	// 
	// // mov r8, m8
	// assembler.mov(al, mem8::ptr(rip, 0x123456));
	// assembler.mov(mem16::ptr(rip, 0x0), cx);
	// utility::console::print("{}\n", bytes_to_string(assembler.get_bytes()));

	return 0;
}
